/*
 Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
*/
(function(){function x(b){return CKEDITOR.env.ie?b.$.clientWidth:parseInt(b.getComputedStyle("width"),10)}function p(b,d){var a=b.getComputedStyle("border-"+d+"-width"),l={thin:"0px",medium:"1px",thick:"2px"};0>a.indexOf("px")&&(a=a in l&&"none"!=b.getComputedStyle("border-style")?l[a]:0);return parseFloat(a)}function C(b){var d=[],a={},l="rtl"==b.getComputedStyle("direction");CKEDITOR.tools.array.forEach(b.$.rows,function(f,D){var e=-1,g=0,c=null;f?(g=new CKEDITOR.dom.element(f),c={height:g.$.offsetHeight,
position:g.getDocumentPosition()}):c=void 0;for(var h=CKEDITOR.env.ie&&!CKEDITOR.env.edge,x="collapse"===b.getComputedStyle("border-collapse"),g=c.height,c=c.position,n=0,z=f.cells.length;n<z;n++){var k=new CKEDITOR.dom.element(f.cells[n]),r=f.cells[n+1]&&new CKEDITOR.dom.element(f.cells[n+1]),e=e+(k.$.colSpan||1),m,t,u=k.getDocumentPosition().x;l?t=u+p(k,"left"):m=u+k.$.offsetWidth-p(k,"right");r?(u=r.getDocumentPosition().x,l?m=u+r.$.offsetWidth-p(r,"right"):t=u+p(r,"left")):(u=b.getDocumentPosition().x,
l?m=u:t=u+b.$.offsetWidth);k=Math.max(t-m,3);h&&x&&(m-=k,k=Math.max(t-m,3));k={table:b,index:e,x:m,y:c.y,width:k,height:g,rtl:l};a[e]=a[e]||[];a[e].push(k);k.alignedPillars=a[e];d.push(k)}});return d}function z(b){(b.data||b).preventDefault()}function F(b){function d(){y=0;c.setOpacity(0);n&&a();var b=e.table;setTimeout(function(){b.removeCustomData("_cke_table_pillars")},0);g.removeListener("dragstart",z)}function a(){for(var c=e.rtl,l=c?r.length:k.length,a=0,f=0;f<l;f++){var g=k[f],d=r[f],m=e.table;
CKEDITOR.tools.setTimeout(function(e,f,g,d,k,n){e&&e.setStyle("width",h(Math.max(f+n,1)));g&&g.setStyle("width",h(Math.max(d-n,1)));k&&m.setStyle("width",h(k+n*(c?-1:1)));++a==l&&b.fire("saveSnapshot")},0,this,[g,g&&x(g),d,d&&x(d),(!g||!d)&&x(m)+p(m,"left")+p(m,"right"),n])}}function l(l){z(l);b.fire("saveSnapshot");l=e.index;for(var a=CKEDITOR.tools.buildTableMap(e.table),d=[],h=[],p=Number.MAX_VALUE,w=p,A=e.rtl,E=0,C=a.length;E<C;E++){var q=a[E],v=q[l+(A?1:0)],q=q[l+(A?0:1)],v=v&&new CKEDITOR.dom.element(v),
q=q&&new CKEDITOR.dom.element(q);v&&q&&v.equals(q)||(v&&(p=Math.min(p,x(v))),q&&(w=Math.min(w,x(q))),d.push(v),h.push(q))}k=d;r=h;m=e.x-p;t=e.x+w;c.setOpacity(.5);B=parseInt(c.getStyle("left"),10);n=0;y=1;c.on("mousemove",D);g.on("dragstart",z);g.on("mouseup",f,this)}function f(c){c.removeListener();d()}function D(c){A(c.data.getPageOffset().x)}var e,g,c,y,B,n,A,k,r,m,t;g=b.document;c=CKEDITOR.dom.element.createFromHtml('\x3cdiv data-cke-temp\x3d1 contenteditable\x3dfalse unselectable\x3don style\x3d"position:absolute;cursor:col-resize;filter:alpha(opacity\x3d0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10000"\x3e\x3c/div\x3e',
g);b.on("destroy",function(){c.remove()});w||g.getDocumentElement().append(c);this.attachTo=function(b){var a,f,d;y||(w&&(g.getBody().append(c),n=0),e=b,a=e.alignedPillars[0],f=e.alignedPillars[e.alignedPillars.length-1],d=a.y,a=f.height+f.y-a.y,c.setStyles({width:h(b.width),height:h(a),left:h(b.x),top:h(d)}),w&&c.setOpacity(.25),c.on("mousedown",l,this),g.getBody().setStyle("cursor","col-resize"),c.show())};A=this.move=function(b,a){if(!e)return 0;if(!(y||b>=e.x&&b<=e.x+e.width&&a>=e.y&&a<=e.y+e.height))return e=
null,y=n=0,g.removeListener("mouseup",f),c.removeListener("mousedown",l),c.removeListener("mousemove",D),g.getBody().setStyle("cursor","auto"),w?c.remove():c.hide(),0;var d=b-Math.round(c.$.offsetWidth/2);if(y){if(d==m||d==t)return 1;d=Math.max(d,m);d=Math.min(d,t);n=d-B}c.setStyle("left",h(d));return 1}}function B(b){var d=b.data.getTarget();if("mouseout"==b.name){if(!d.is("table"))return;for(var a=new CKEDITOR.dom.element(b.data.$.relatedTarget||b.data.$.toElement);a&&a.$&&!a.equals(d)&&!a.is("body");)a=
a.getParent();if(!a||a.equals(d))return}d.getAscendant("table",1).removeCustomData("_cke_table_pillars");b.removeListener()}var h=CKEDITOR.tools.cssLength,w=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks);CKEDITOR.plugins.add("tableresize",{requires:"tabletools",init:function(b){b.on("contentDom",function(){var d,a=b.editable();a.attachListener(a.isInline()?a:b.document,"mousemove",function(a){a=a.data;var f=a.getTarget();if(f.type==CKEDITOR.NODE_ELEMENT){var h=a.getPageOffset().x,
e=a.getPageOffset().y;if(d&&d.move(h,e))z(a);else if(f.is("table")||f.getAscendant({thead:1,tbody:1,tfoot:1},1))if(a=f.getAscendant("table",1),b.editable().contains(a)){(f=a.getCustomData("_cke_table_pillars"))||(a.setCustomData("_cke_table_pillars",f=C(a)),a.on("mouseout",B),a.on("mousedown",B));a:{a=f;for(var f=0,g=a.length;f<g;f++){var c=a[f];if(h>=c.x&&h<=c.x+c.width&&e>=c.y&&e<=c.y+c.height){h=c;break a}}h=null}h&&(!d&&(d=new F(b)),d.attachTo(h))}}})})}})})();